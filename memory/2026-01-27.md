# 2026-01-27

## Morning Session - Otto's Command Center System Design

Otto shared a comprehensive system design for his Personal Agentic System (PAS):

### Core Concept: 3-Dimensional Knowledge Graph
1. **Hierarchy (P.A.R.A.)**: Areas ‚Üí Projects ‚Üí Tasks ‚Üí Sub-Tasks (Tree topology)
2. **State (GTD)**: Inbox ‚Üí Next_Action ‚Üí Waiting_For ‚Üí Someday/Maybe ‚Üí Done
3. **Network (Zettelkasten)**: Cross-cutting edges (BLOCKS, IMPLEMENTS, REFERENCES)

### Neo4j Schema
- **Nodes**: :Area, :Project, :Task, :Decision, :Resource
- **Edges**: [:BELONGS_TO], [:BLOCKS], [:IMPLEMENTS], [:REFERENCES], [:HAS_GAP]

### Key Components
1. **Scribe (Context Manager)**: Extracts JSON from conversations
2. **Python Bridge**: Ingests to Neo4j with MERGE, ghost nodes, timestamps
3. **Meta-Thinker (LangGraph)**:
   - Audit_Topology: Find orphans, detect cycles
   - Calc_Next_Action: Auto-promote when blockers clear
   - Gap_Analysis: Strategic risk detection

### Current Notion Structure
- Areas DB: üìà, üè†, üíº
- Projects DB: Linked to Areas, Status/Priority
- Agent Task Tracker: Waves, Prerequisites, Approval Status
- Document Index (VDR): VDR Folder, Document Type, Tags, Status
- Resources DB: Type, Tags, Files

### Integration Plan
Otto wants agents to:
- Populate VDR and task databases
- Manage schedules, summarize meetings/calls
- Organize work visually in Notion (enhanced version)

### Connected Notion API
- Key stored at ~/.config/notion/api_key
- Integration connected to main workspace page

---

## Afternoon Session - Chimera TDD Implementation

### Built Operator Module (`~/chimera/src/operator/`)
TDD-first implementation of core brain components:

1. **ContextEngine** (`context-engine.js`)
   - Working memory: focus tracking, recent items stack
   - Reference resolution: "that task" ‚Üí most recent task
   - Conversation history with entity extraction

2. **Router** (`router.js`)
   - Intent classification: create_task, query, update_status, create_project
   - Task detail extraction from natural language (priority, due dates)
   - Routes to appropriate handlers

3. **GTDEngine** (`gtd-engine.js`)
   - Task/Project/Area CRUD with SQLite
   - Dependency management with cycle detection
   - **Auto-promotion**: `calcNextActions()` promotes waiting_for ‚Üí next_action when blockers clear
   - Orphan detection and inbox linking
   - Full audit cycle

### Built Voice Pipeline (`~/chimera/src/voice/`)
1. **STTEngine** - Mock mode + Whisper integration point
2. **TTSEngine** - Mock mode + real TTS point (Piper, ElevenLabs)
3. **VoiceRouter** - Natural language intent extraction + response generation

### Test Coverage
- `operator.test.js` ‚Äî 22 tests ‚úÖ
- `voice-pipeline.test.js` ‚Äî 27 tests ‚úÖ (2 skipped for real STT/TTS)
- **Total Chimera tests: 158 passing**

### Key Design Decisions
- SQLite over Neo4j for simplicity (can migrate later)
- Mock-first testing for voice (real integration later)
- Custom handlers support in Router for extensibility
- No foreign key constraints on tasks (flexibility for orphans)

---

## Voice Integration to oopuo-OS

### Added to oopuo-OS Frontend
- `lib/hooks/useVoice.ts` - React hook for WebSocket voice connection
- `components/voice/VoiceControl.tsx` - Floating mic button (bottom-right)
- Added to root layout.tsx - auto-appears on all pages

### Chimera Voice Server
- `src/voice/cli.js` - CLI to start voice WebSocket server
- `scripts/install-voice.sh` - Installer for Python deps (faster-whisper, chatterbox-tts)

### Usage
```bash
# Start voice server (mock mode)
cd ~/chimera && node src/voice/cli.js

# With real STT/TTS (requires GPU + Python deps)
~/chimera/scripts/install-voice.sh
source ~/.chimera-voice-venv/bin/activate
node src/voice/cli.js --stt --tts
```

oopuo-OS running at http://localhost:3001 - mic button connects to ws://localhost:8765

## 21:28 - Omiximo Duplicate Orders Bug Fix
Otto reported `./ctl.sh sales` showed 9 orders but UI had only 2. Investigation found:
- **Root cause**: `scripts/test_today.py` (hourly runner) didn't use `ProcessedEmailTracker`
- Same email processed multiple times ‚Üí duplicate sales orders
- `01241_298187025-A` appeared 3x, `A000E71TN6` appeared 6x

**Fix applied**: Added deduplication to `test_today.py`:
- Import and initialize `ProcessedEmailTracker`
- Check `is_processed(message_id)` before processing
- Call `mark_processed()` after successful execution

Container fix applied via `docker cp`. Local file also updated.
Existing duplicates need manual cleanup in InvenTree.
